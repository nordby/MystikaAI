# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –≤ –±–æ—Ç–µ

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. üéØ –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
**–ë—ã–ª–æ**: –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–°—Ç–∞–ª–æ**: –ë–æ—Ç —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `user.preferences.cardGeneration`

### 2. üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

#### –í —Ñ—É–Ω–∫—Ü–∏–∏ `handleReadingCallback()` (—Å—Ç—Ä–æ–∫–∞ ~1204):
```javascript
// –ë–´–õ–û:
const imageResponse = await database.generateSpreadImages(cardsWithReverse, readingType);

// –°–¢–ê–õ–û:
// –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const userPreferences = user.preferences || {};
const cardGeneration = userPreferences.cardGeneration || {};

if (cardGeneration.parallelGeneration !== false) {
  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å—Ç–∏–ª–µ–º
  imageResponse = await database.generateMultipleCardImages(cardsForGeneration, {
    style: cardGeneration.defaultStyle || 'mystic',
    maxConcurrent: 3
  });
} else {
  // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
  imageResponse = await database.generateSpreadImages(cardsForGeneration, readingType);
}
```

#### –í —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö:
- `handleTestImageGeneration()` - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `handleTestParallelGeneration()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `handleShowUserSettings()` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 3. üìã –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –º–µ–Ω—é: **"üìã –ú–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"**

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- üé® –°—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- üîÑ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–í–ö–õ/–í–´–ö–õ)  
- ‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–í–ö–õ/–í–´–ö–õ)
- üîÆ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–í–ö–õ/–í–´–ö–õ)
- üíé –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–í–ö–õ/–í–´–ö–õ)

### 4. üîç –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –∫–æ–Ω—Å–æ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ—è–≤–ª—è—é—Ç—Å—è –ª–æ–≥–∏:
```
üé® Bot: Using card generation settings for user 123456789: {defaultStyle: "classic", ...}
üîÑ Bot: Using parallel generation with style: classic
‚úÖ Bot: Generated 3 card images successfully
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. üì± –í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
1. –ó–∞–π–¥–∏—Ç–µ –≤ **–ü—Ä–æ—Ñ–∏–ª—å** ‚Üí **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–∞—Ä—Ç**
2. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∏–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å "mystic" –Ω–∞ "classic")
3. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"** 
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!"

### 2. ü§ñ –í –±–æ—Ç–µ:
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/test`
2. –ù–∞–∂–º–∏—Ç–µ **"üìã –ú–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Å—Ç–∏–ª—å
4. –ù–∞–∂–º–∏—Ç–µ **"üåê –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"** - –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å—Å—è –ø—Ä–æ—Ñ–∏–ª—å

### 3. üé¥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
1. –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ **"üîÆ –ù–æ–≤–æ–µ –≥–∞–¥–∞–Ω–∏–µ"** ‚Üí –ª—é–±–æ–π —Ä–∞—Å–∫–ª–∞–¥
2. –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏ —Å –≤–∞—à–∏–º —Å—Ç–∏–ª–µ–º:
   ```
   üé® Bot: Using card generation settings for user [–≤–∞—à_id]: {defaultStyle: "classic", ...}
   üîÑ Bot: Using parallel generation with style: classic
   ```
3. –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å–∫–ª–∞–¥ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å—Ç–∏–ª–µ

### 4. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. –í –±–æ—Ç–µ `/test` ‚Üí **"‚ö° –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç"**
2. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è: "üé® –°—Ç–∏–ª—å: –≤–∞—à_–≤—ã–±—Ä–∞–Ω–Ω—ã–π_—Å—Ç–∏–ª—å"
3. –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

### –í –∫–æ–Ω—Å–æ–ª–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```
üîß Updating card generation settings: {defaultStyle: "classic", ...}
üíæ Saving card generation settings to server: {defaultStyle: "classic", ...}
‚úÖ Profile saved successfully, user preferences: {cardGeneration: {...}}
```

### –í –∫–æ–Ω—Å–æ–ª–∏ –±–æ—Ç–∞:
```
üé® Bot: Using card generation settings for user 123456789: {defaultStyle: "classic", ...}
üìã Bot: Showing settings for user 123456789: {cardGeneration: {...}}
üß™ Bot: Testing parallel generation for user 123456789 with style: classic
```

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª—å –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (Profile.jsx)
   ‚Üì
2. updateCardGeneration() –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π store
   ‚Üì  
3. handleSaveProfile() –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   ‚Üì
4. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ user.preferences.cardGeneration
   ‚Üì
5. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ ensureUser()
   ‚Üì
6. handleReadingCallback() —á–∏—Ç–∞–µ—Ç user.preferences.cardGeneration
   ‚Üì
7. generateMultipleCardImages() –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cardGeneration.defaultStyle
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:
- `defaultStyle`: 'mystic'
- `autoGenerate`: true (–≤–∫–ª—é—á–µ–Ω–∞)  
- `parallelGeneration`: true (–≤–∫–ª—é—á–µ–Ω–∞)
- `fallbackEnabled`: true (–≤–∫–ª—é—á–µ–Ω–∞)
- `highQuality`: false (–≤—ã–∫–ª—é—á–µ–Ω–∞)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

1. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∏–ª—å –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ "fantasy"
2. –í –±–æ—Ç–µ `/test` ‚Üí "üìã –ú–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
3. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å—Å—è "üé® –°—Ç–∏–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: fantasy"  
4. –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å–∫–ª–∞–¥ - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "style: fantasy"

–¢–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—Ä—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –±–æ—Ç–æ–º! üéâ